version: "~> 1.0"
language: node_js
os: linux
dist: focal
if: branch = "stable" OR tag IS present
jobs:
  include:
    - stage: Test the project
      name: Test the project on Linux with NodeJS 16
      os: linux
      dist: focal
      services:
        - xvfb
      node_js: "16"
      script: npm run build && xvfb-run --auto-servernum --server-args="-screen 0 1024x768x24" npm run test
    - stage: Release to NPM
      name: Publish the package to the npmjs repository
      os: linux
      dist: focal
      node_js: "16"
      script: npm run build
      deploy:
        edge: true
        provider: npm
        email: npmjs@eraud.dev
        api_token:
          secure: TM8q4PnBZGF56Ciub4yFx6x7VrrFoY1CBBHWF9h759T9wtX5kUpsQeIC1bqZacYtBGq1ncCEKWT0l8AY8qBi1K5++hmD3yYmsDXp3CJgKpTZh62KPPTPaDCa/xkjMSwACK9wD6f3iwQH/qaAfbl9ojyC3L7JY2sJcqNo6N4EdasEhsqcrm3oMWeoVacLXoGyva/s8Gi+MLvqqEvHOUZZmbeMtvOWpeoZ8Wb21ZQHUcsnuuAmEmgWlYUXEQfnzlcDVa9VnpJ/mrxBT71Ww2eqWzhnWWhWUBthh/wRcKiXnLTv4PJ5zQndP6mj6DESmdOu5I/36ILk7tf+rnFV/bA4Or1YHSyUyqyvXRZa4e5+OeMF9T6yG2bOXF4F7wIktOcI3k0h5NSdVM9Ql/EXx6vlE+tToGop+m68epWJ59i5YU01cIF5Nw/rzUfjq1/6uA0jM00Ax5URy5wZcB8ja9AABxf20YW4zf6L65KlW5OG+2OGHSytTCB6XcuwfGkN5mmxhVAOEnTU7vdUK5PNoI8wC867Nu4Gqzp1FvRjlUi9pf8rGJJLAwJrLB1EfDWGRhGfJOlup15BVVM9xy/Bn1z0AOwXYwCalP+VpIVCQWQhn4i1xsGdYWTHr3XJSVQSjQy3rw+FXj4+CoPcJvihuH0qk2xqxNKHHGl3xQGsdY9BBQE=
        on:
          tags: true
          repo: lesjoursfr/html-to-pdf
          branch: stable
        cleanup: false
notifications:
  slack:
    secure: tO9rYadusEaMMoQQ77W4XTGVImuEmOVt2jR7G9Bfq+ddH0Af3mGnqzx+2cXL/c3LX+W1yWRRHZopaX3ueMru29sN7OhJehTdCSIDXkNzPOruYqy7ueqlhyIS8OoFoH1UA0vnzsXW1T4nf4xohjLY9LDZOjknSQk8MoivFo566/p6noKJg9ulIHDEydljmZbApbf9mgAhvwgcOeAr/sNH81G5iKcp11RS9731O6nYkPT2jIo3C9Q6sUnINz55UvzrFFMnRrm3xX0DMfxMZzonylRtnVHTnFP9mrQ49M0gjK+47DPL0scytjIrUbKWID/rFx0RaFvt+8UcwHtTpz0T1wRaWEo86/1evJqWkKgfpPPLkjHtQXSo6Xb53fFHkoAjysYzwidWYU5WVBohIGJicF9zLzbqOkZQ1dUnUEQJXPU4ODsaIwygvO55H7iy6jNPFXl6rGXdh5wsPAEOC8FNewtNM01PXOk1mC6jcmr+AzEub8Yz2zs6E17VQRvTGKmy7DNZkgKEVPKyibfWvIfJZcnphi1vNKs+fVTrV2XYy7UzGd1y0UTNB8kOvhVGDRN0sQwHolF0497FP5AqxwiXa7864jwxGU5oCdDYNMXwjGRmSOwz88zK0muQNghxQKQjD3rfvVB9JI85y7QQ1fQPxmoM7IZkCx7nPNxz8ownKgs=
